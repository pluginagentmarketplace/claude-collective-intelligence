# RabbitMQ Configuration File
# Generated: 2025-12-07 (Week 2 Phase 4 - Infrastructure Organization)
# Referenced by: docker-compose.dev.yml

# ============================================
# Network & Listeners
# ============================================

# Allow remote connections (disable guest user restriction)
loopback_users.guest = false

# Default TCP listener
listeners.tcp.default = 5672

# Management plugin port
management.tcp.port = 15672

# Enable management statistics
management_agent.disable_metrics_collector = false

# ============================================
# Logging Configuration
# ============================================

# Log to console (for Docker container logs)
log.console = true
log.console.level = info

# File logging
log.file.level = info
log.file.rotation.date = $D0
log.file.rotation.size = 10485760

# Connection logging
log.connection.level = info

# ============================================
# Memory & Resource Management
# ============================================

# Memory threshold (60% of available RAM)
vm_memory_high_watermark.relative = 0.6

# Paging threshold (when to start paging to disk)
vm_memory_high_watermark_paging_ratio = 0.75

# Disk free space threshold (2GB minimum)
disk_free_limit.absolute = 2GB

# ============================================
# Queue & Message Settings
# ============================================

# Default queue message TTL (24 hours)
# default_vhost.queues.message_ttl = 86400000

# Maximum queue length (prevent runaway queues)
# max_length = 100000

# Dead letter exchange (optional)
# default_vhost.dead_letter_exchange = dlx

# ============================================
# Performance Tuning
# ============================================

# Heartbeat timeout (60 seconds)
heartbeat = 60

# Channel max (number of channels per connection)
channel_max = 2048

# Frame max (max frame size)
frame_max = 131072

# Collect statistics every 5 seconds
collect_statistics_interval = 5000

# ============================================
# Clustering (Optional - for multi-node setup)
# ============================================

# Cluster formation
cluster_formation.peer_discovery_backend = rabbit_peer_discovery_classic_config

# Node name
# cluster_formation.classic_config.nodes.1 = rabbit@node1
# cluster_formation.classic_config.nodes.2 = rabbit@node2

# ============================================
# Security & Authentication
# ============================================

# Default user (overridden by RABBITMQ_DEFAULT_USER env var)
# default_user = admin
# default_pass = rabbitmq123

# TLS/SSL (disabled by default, enable for production)
# listeners.ssl.default = 5671
# ssl_options.cacertfile = /path/to/ca_certificate.pem
# ssl_options.certfile   = /path/to/server_certificate.pem
# ssl_options.keyfile    = /path/to/server_key.pem
# ssl_options.verify     = verify_peer
# ssl_options.fail_if_no_peer_cert = true

# ============================================
# Plugins
# ============================================

# Enabled plugins managed via enabled_plugins file
# Common plugins:
# - rabbitmq_management (web UI)
# - rabbitmq_management_agent (metrics collection)
# - rabbitmq_prometheus (Prometheus metrics)
# - rabbitmq_shovel (message forwarding)
# - rabbitmq_federation (distributed messaging)

# ============================================
# Advanced Settings (Use with caution)
# ============================================

# TCP buffer size
tcp_listen_options.backlog = 128
tcp_listen_options.nodelay = true
tcp_listen_options.linger.on = true
tcp_listen_options.linger.timeout = 0

# Management UI settings
management.load_definitions = /etc/rabbitmq/definitions.json

# ============================================
# Monitoring & Observability
# ============================================

# Prometheus metrics
# prometheus.tcp.port = 15692
# prometheus.path = /metrics

# ============================================
# Development vs Production Notes
# ============================================

# DEVELOPMENT:
# - Use loopback_users.guest = false for easy access
# - Enable verbose logging for debugging
# - Lower resource thresholds acceptable

# PRODUCTION:
# - Set strong credentials via env vars
# - Enable TLS/SSL
# - Increase memory thresholds
# - Enable clustering for HA
# - Configure monitoring (Prometheus)
# - Set up alerting rules

# ============================================
# Environment-Specific Overrides
# ============================================

# Override these settings using environment variables:
# RABBITMQ_DEFAULT_USER
# RABBITMQ_DEFAULT_PASS
# RABBITMQ_ERLANG_COOKIE (for clustering)
# RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS

# ============================================
# References
# ============================================

# Official documentation:
# https://www.rabbitmq.com/configure.html
# https://www.rabbitmq.com/production-checklist.html
